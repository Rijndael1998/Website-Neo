import { Accordion, AccordionDetails, AccordionSummary, Container } from "@mui/material";
import ExpandMoreIcon from '@mui/icons-material/ExpandMore';
import DarkModeFix from '@/components/muiWrappers/darkModeFix/_darkModeFix';
import Lazy from "@/components/lazy/_lazy";
import LazyLocalImage from "@/components/lazy/_lazyLocalImage";
import { generateCustomMetadata } from "@/Metadata";

import logo from "./opengraph-image.png";
import s0 from "./images/s0.png";
import s0b from "./images/s0b.png";
import s1 from "./images/s1.png";
import s2 from "./images/s2.png";
import s3 from "./images/s3.png";
import s4 from "./images/s4.png";
import s5 from "./images/s5.png";
import s6 from "./images/s6.png";
import s7 from "./images/s7.png";

export const metadata = {
    title: 'Get OpenWrt 5.15 working on Octaplus (CityFibre)',
    description: "A quick guide to configuring OpenWrt 5.15 for Octaplus on CityFibre: VLAN ID 911, PPPoE credentials, and troubleshooting tips.",
};

<DarkModeFix>
<Container maxWidth="md">

# Get OpenWrt 5.15 working on Octaplus (CityFibre)

<LazyLocalImage src={logo} />

[CityFibre](https://cityfibre.com/) provides fast, fiber-optic internet in the UK. [Octaplus](https://octaplus.co.uk/) is one of the providers on CityFibre, but they didn't make it straightforward for me to set up my own router. The only things support told me to do were:
 - Tag the VLAN with `911`.
 - Set the username to `firstName_lastName`.
 - Set the password to `london`.

At the time, I was very new to OpenWRT and didn't fully understand how the system worked. I couldn't get it working during the support call. However, through trial and error and extensive web searching, I managed to set it up.

<div>
    <Accordion>
        <AccordionSummary
            expandIcon={<ExpandMoreIcon />}
        >
            {"Add a new device configuration"}
        </AccordionSummary>
        <AccordionDetails>
            Navigate to: Network -> Interfaces -> Devices (tab)
            <LazyLocalImage src={s0} />

            You should end up here:
            <LazyLocalImage src={s1} />

            Now add a new device configuration by clicking the "Add device configuration..." button and set up your new device like this:
            <LazyLocalImage src={s2} />

            Remember to choose the base device that is connected to your ISP's box. In this example, that device is `eth1`. The most important things are that the VLAN ID tag is **`911`** and the <u>device type</u> is **`802.1q`**. Every other setting can be left at its default. At the time of writing, Octaplus doesn't provide IPv6 addresses; you can disable it if you choose.

            When you're done, save and create the device. You should see something like this:
            <LazyLocalImage src={s3} />

        </AccordionDetails>
    </Accordion>
    <Accordion>
        <AccordionSummary
            expandIcon={<ExpandMoreIcon />}
        >
            {"Add the WAN zone"}
        </AccordionSummary>
        <AccordionDetails>
        Navigate to: Network -> Interfaces -> Interfaces (tab)
        <LazyLocalImage src={s0b} />

        I simply reused the default `wan` interface that came with OpenWRT. Alternatively, you can create a new interface like this:
        <LazyLocalImage src={s5} />
        Make sure to base it on the `eth1.911` device you created earlier, and select the interface protocol as `PPPoE`.

        After you create your interface or open its configuration, you'll see a form asking for details:
        <LazyLocalImage src={s6} />
        The CHAP/PAP username is your name with an underscore between your first and last name. For example, if your name is John Doe, the username will be `john_doe`.
        The CHAP/PAP password is `london`.

        You might want to ask Octaplus support for your details if your credentials are not working. Their website claims to help you set up your own router, so this should be provided to you at the very least.

        If you've created your own interface, remember to add it to the firewall:
        <LazyLocalImage src={s7} />

        Once you set up your interface, save, and give it some time, you should see it connect and receive an IP address:
        <LazyLocalImage src={s4} />

        </AccordionDetails>
    </Accordion>
    <Accordion>
        <AccordionSummary
            expandIcon={<ExpandMoreIcon />}
        >
            {"Caveats & Troubleshooting"}
        </AccordionSummary>
        <AccordionDetails>
        <div>
            Even after setting everything up, it didn't work right away. I had to take the following steps.

            Octaplus support pointed out that the service is bound to a MAC address. To get it working, I spoofed the MAC address of my previous device. To change the MAC address, go to Network -> Interfaces -> Devices (tab), click Configure under the device you need to change, and set the MAC address accordingly. This should only be necessary if you previously used a different router and are now replacing it with a new OpenWRT device.

            You might also need to reset both the router and the termination device. Turn the termination device off for around 5 minutes, then turn it back on. You can simply reboot the OpenWRT instance.

            You can also call Octaplus, as they can see what's happening on their end. From time to time, they have outages or misconfigurations. It doesn't hurt to ask.
        </div>
        </AccordionDetails>
    </Accordion>
</div>

</Container>
</DarkModeFix>